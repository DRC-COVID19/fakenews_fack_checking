<% extend('../../layout/layout') %>
<div class="container">
  <div class="content mt-5">
    <div class="row justify-content-center">
      <div class="col-sm-8">
        <h1>
          Avez-vous vu ou entendu des informations erronées sur le coronavirus ?
          Dites-nous tout
        </h1>
        <div class="form-description">
          <p>
            Nous comptons sur votre active participation pour avoir des
            informations sur lesquelles effectuer le fact checking
            (vérifications des faits).
          </p>
          <hr />
          <p>
            Soyez aussi concis et précis que possible. Incluez des liens ou des
            captures d'écran si vous en avez. Cela aide nos vérificateurs à
            travailler plus rapidement.
          </p>
        </div>
        <p id="err" style="color: red;"></p>
        <div class="content-card main-card">
          <div class="body">
            <form
              id="request_factcheck"
              class=""
              action="/api/news/"
              method="post"
              enctype="multipart/form-data"
            >
              <div class="row">
                <div class="col-12">
                  <label for="description">
                    <p class="label-title">
                      Quelle question, préoccupation ou expérience
                      souhaitez-vous partager à propos de COVID-19 ou du
                      coronavirus?
                    </p>
                    <p class="label-description">
                      Avec vos propres mots, partagez toutes les rumeurs,
                      «conseils» ou histoires personnelles que vous avez
                      rencontrées et que STOPCORONAVIRUS devrait enquêter.
                    </p>
                  </label>
                  <textarea
                    class="form-control"
                    id="description"
                    name="description"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <div class="col-12">
                  <label for="sources">
                    <p class="label-title">
                      Vous avez un lien vers un exemple ou d'autres informations
                      qui aideront nos vérificateurs de faits?
                    </p>
                    <p class="label-description">
                      Ceci est facultatif, mais vraiment utile. Veuillez
                      renseigner un lien par ligne s'il vous plaît.
                    </p>
                  </label>
                  <textarea
                    class="form-control"
                    id="sources"
                    name="sources"
                    rows="3"
                  ></textarea>
                </div>
                <div class="col-12">
                  <label for="media">
                    <p class="label-title">
                      Vous avez une capture d'écran ?
                    </p>
                    <p class="label-description">
                      Ce champs est optionel
                    </p>
                  </label>
                  <input
                    id="media"
                    class="form-control"
                    type="text"
                    name="media"
                    value=""
                  />
                </div>
                <div class="col-12">
                  <label for="email">
                    <p class="label-title">
                      STOPCORONAVIRUS peut-il vous joindre ?
                    </p>
                    <p class="label-description">
                      Si oui, laissez-nous votre email. Ceci est facultatif
                    </p>
                  </label>
                  <input
                    id="email"
                    class="form-control"
                    type="text"
                    name="email"
                    value=""
                  />
                </div>
                <div class="col-12">
                  <label for="fullName">
                    <p class="label-title">Laissez-nous votre nom</p>
                    <p class="label-description">
                      Optionnel. Ceci nous permettrait de personnaliser toute
                      correspondance future en avec votre nom.
                    </p>
                  </label>
                  <input
                    id="fullName"
                    class="form-control"
                    type="text"
                    name="fullName"
                    value=""
                  />
                </div>
                <div class="col-12">
                  <label for="location">
                    <p class="label-title">Votre emplacement</p>
                    <p class="label-description">Pays, Ville ou Commune</p>
                  </label>
                  <input
                    id="location"
                    class="form-control"
                    type="text"
                    name="location"
                    required
                    value=""
                  />
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <input
                    type="submit"
                    class="btn btn-dark"
                    name=""
                    value="Envoyer"
                  />
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const description = document.querySelector("#description");
    const sources = document.querySelector("#sources");
    const media = document.querySelector("#media");
    const email = document.querySelector("#email");
    const senderLocation = document.querySelector("#location");
    const fullName = document.querySelector("#fullName");

    const formData = {};

    for (let field of [
      description,
      sources,
      media,
      email,
      fullName,
      senderLocation,
    ]) {
      field.addEventListener("input", (e) => {
        const {
          target: { name, type, value, checked, files },
        } = e;
        if (field === email || field === fullName) {
          formData["author"] = {
            ...formData["author"],
            [name]: value,
          };
        } else if (field === senderLocation) {
          formData["location"] = value;
        } else if (field === sources || field === media) {
          formData[name] = value?.trim()?.split("\n");
        } else {
          formData[name] = value;
        }
      });
    }

    const requestFactcheck = document.querySelector("#request_factcheck");

    requestFactcheck.addEventListener("submit", function (e) {
      e.preventDefault();
      const image = document.querySelector("#customFile");
      const regexEmail = new RegExp(
        /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
      );
      if (
        !description.value.length ||
        !senderLocation.value.length ||
        (email.value.length && !regexEmail.test(email.value))
      ) {
        const err = document.querySelector("#err");
        err.innerHTML =
          "Le champ <b>description</b> et <b>emplacement</b> sont obligatoires et doivent être valides";
      } else {
        e.target.value = "Envoi des données...";
        axios
          .post("/api/news/", formData)
          .then((res) => {
            description.value = "";
            email.value = "";
            location.value = "";
            fullName.value = "";
            sources.value = "";
            media.value = "";
            e.target.value = "Envoyer";
            err.style.color = "white";
            err.style.backgroundColor = "#25e487";
            err.style.fontWeight = "bold";
            err.innerText = "Informations envoyées pour verification";
            err.style.fontSize = "1.5em";
            window.location.href = "http://localhost:5000/";
          })
          .catch((err) => console.log(err));
      }
    });
  </script>
</div>
